{extend name="base/base"}
{block name="body"}
<div class="passport">
	<h3>注册账号</h3>
	<form method="post" action="/register.html" id="form1" class="p05em">
		<input type="text" name="username" id="username" placeholder="用户名" />
		<input type="password" name="password" id="password" placeholder="密码" />
		<input type="password" name="repassword" id="repassword" placeholder="确认密码" />
		<input type="text" name="email" id="email" placeholder="电子邮箱" />
		<input type="submit" value="注册">
		<div class="action clearfix">
			<a href="/login.html">返回登录</a>
		</div>
	</form>
</div>
<div class="closediv fa fa-close" onClick="top.$('.passportdiv').remove();"></div>
{/block}
{block name="files"}
<link rel="stylesheet" href="/files/passport.css" />
{/block}
{block name="script"}
<script>
$(document).ready(function(){
	$('#form1').submit(function(){
		if(!$(this).find('input[name="username"]').val()){
			top.errmsg('请填写用户名！');
			return false;
		}
		if(!$(this).find('input[name="password"]').val()){
			top.errmsg('请填写密码！');
			return false;
		}
		if(!$(this).find('input[name="repassword"]').val()){
			top.errmsg('请填写确认密码！');
			return false;
		}
		if($(this).find('input[name="password"]').val()!=$(this).find('input[name="repassword"]').val()){
			top.errmsg('两次输入的密码不一致！');
			return false;
		}
		if(!$(this).find('input[name="email"]').val()){
			top.errmsg('请填写电子邮箱！');
			return false;
		}
		var self = $(this);
		$.post(self.attr("action"), self.serialize(), success, "json");
		return false;

		function success(data){
			if(data.ok){
				if(data.uc){
					var exp=/(http\:\/\/.*?)\"{1}/ig;
					var jsurl;
					while((jsurl=exp.exec(data.uc))!=null){
						//$.getScript(result);
						//$.get(result);
						$('<img/>').attr('src',jsurl);
					}
				}
				top.okmsg(data.msg,function(){
					top.location.reload();
				});
			} else {
				top.errmsg(data.msg);
			}
		}
	});
});
</script>
{/block}